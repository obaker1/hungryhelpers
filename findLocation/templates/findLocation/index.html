<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>
    <h2>Find Your Location</h2>
    {% load static %}
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <link rel="stylesheet" href="{% static 'css/style.css'%}">
    <script type="text/javascript" src="{% static 'findLocation/index.js'%}"></script>
</head>
<body>
    <form action="{% url 'addOrigin' %}" method="post"}>
        {% csrf_token %}
        Enter your location:
        <input type="text" name="origin"> <br>
        <input type="submit">
    </form>
    <form action="{% url 'addLocation' %}" method="post"}>
        {% csrf_token %}
        Enter a destination:
        <input type="text" name="destination"> <br>
        Is the destination a school (y/n)?
        <input type="text" name="school"> <br>
        Is the destination a bus stop (y/n)?
        <input type="text" name="bus"> <br>
        Do you want to add or remove this destination (a/r)?
        <input type="text" name="remove"> <br>
        <input type="submit">
    </form>
    </br>
    <div id="right-panel">
        <div>
            <!-- displays the origins and destinations from closest for furthest !-->
            <strong>Origin: </strong> {{ origin }} <br>
            <strong>Destinations</strong>
            <ol>
                {% for locations in googlemapsresult %}
                <li>{{ locations.location }}: {{locations.distance}} miles in {{locations.time}}</li>
                {% endfor %}
            </ol>
        </div>
    </div>
    <div id="buttons">
        <input type="checkbox" name="filter" id="school" class='chk-btn'>
        <label for='school'>school</label>

        <input type="checkbox" name="filter" id="bus" class='chk-btn'>
        <label for='bus'>bus stop</label>
        <br>
    </div>
    <br>
    <div id="map"></div>
    <br>
    <div id="places_info"></div>
    <!-- Async script executes immediately and must be after any DOM elements used in callback. -->
    {{ api_key|json_script:"api_key" }}
    <!-- sets origin and destination values and calls the google maps api that will display the map !-->
    <script async type="text/javascript">
            var origin = "{{origin}}";
            var destinationString = "{{destinationList}}";
            var filterString = "{{filter}}";
            var destinationList = []
            if( destinationString != "None"){
                destinationList = destinationString.split("|");
            }
            if( filterString != "None"){
                filterString = filterString.split("|");
            }
            setParameters(origin, destinationList, filterString);
            const api_key = JSON.parse(document.getElementById('api_key').textContent);
            const google_api_script = document.createElement('script');
            google_api_script.setAttribute('src','https://maps.googleapis.com/maps/api/js?key=' + api_key + '&callback=initMap&libraries=&v=weekly');
            document.head.appendChild(google_api_script);
    </script>
</body>
</html>
